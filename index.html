<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    
    <!-- PWA Meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–ë—Ä–∏–≥–∞–¥—ã">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
    <link rel="manifest" href="manifest.json">
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#667eea">
    
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∞–º–∏ –∏ —Å–∫–ª–∞–¥–æ–º</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --tab-bar-height: 70px;
        }

        * {
            box-sizing: border-box;
        }
        
        html {
            width: 100%;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            position: relative;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            color: #1d1d1f;
            font-size: 14px;
            padding-bottom: calc(var(--tab-bar-height) + env(safe-area-inset-bottom));
        }
        
        *:not(script):not(style) {
            -webkit-user-select: none; user-select: none;
        }
        
        input, textarea, select {
            -webkit-user-select: text; user-select: text;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
            box-sizing: border-box;
            position: relative;
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 1200px; padding: 20px;
            }
            body {
                font-size: 16px;
            }
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            position: relative;
        }
        
        @media (min-width: 768px) {
            .header {
                border-radius: 20px; padding: 20px; margin-bottom: 20px;
            }
        }
        
        .header h1 {
            margin: 0;
            color: #1d1d1f;
            font-size: 16px;
            font-weight: 600;
            flex-grow: 1;
            min-width: 120px;
        }
        
        @media (min-width: 480px) {
            .header h1 { font-size: 20px; }
        }
        
        @media (min-width: 768px) {
            .header h1 { font-size: 28px; }
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .user-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
        }
        
        @media (min-width: 768px) {
            .user-badge {
                padding: 8px 16px; border-radius: 20px; font-size: 14px; max-width: none;
            }
        }

        #reports-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            min-height: 40px;
        }
        
        .logout-btn {
            background: #ff3b30;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            min-height: 40px;
        }
        
        @media (min-width: 768px) {
            .logout-btn, #reports-btn {
                padding: 10px 18px; border-radius: 20px; font-size: 14px;
            }
        }
        
        .logout-btn:hover {
            background: #d70015; transform: translateY(-2px);
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .main-content { border-radius: 20px; }
        }
        
        .tabs {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: var(--tab-bar-height);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            background: rgba(248, 249, 250, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 100;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .tab {
            padding: 4px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 11px;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
            position: relative;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 100%;
            border-top: 3px solid transparent;
        }
        .tab span:first-child {
            font-size: 20px;
        }
        
        @media (min-width: 768px) {
            .tab {
                flex: 1; font-size: 16px; flex-direction: row;
            }
        }
        
        .tab.active {
            color: #667eea; border-top-color: #667eea;
        }
        
        .tab:hover:not(.active) {
            background: rgba(233, 236, 239, 0.5); color: #495057;
        }
        
        .tab-content {
            display: none; padding: 15px; animation: fadeIn 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .tab-content { padding: 30px; }
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            margin-bottom: 1px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e9ecef;
            border-radius: 0 0 8px 8px;
            overflow: hidden;
            touch-action: pan-y;
        }
        
        .calendar-header {
            text-align: center;
            font-weight: 600;
            padding: 10px 4px;
            background: #667eea;
            color: white;
            font-size: 12px;
        }
        
        @media (min-width: 768px) {
            .calendar-header { padding: 15px 10px; font-size: 14px; }
        }
        
        .calendar-day {
            background: white;
            padding: 2px;
            aspect-ratio: 1 / 1.6;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            flex-direction: column;
        }
        
        .calendar-day:hover {
            transform: scale(1.02); z-index: 10;
        }
        
        .calendar-day.today {
            box-shadow: inset 0 0 0 2px #007aff; z-index: 50; position: relative;
        }
        
        .calendar-day.other-month {
            background: #f8f9fa; color: #adb5bd; cursor: default;
        }
        .calendar-day.other-month:hover {
            transform: none;
        }
        
        .day-number {
            font-weight: 600;
            font-size: 10px;
            line-height: 1;
            align-self: flex-start;
            padding: 2px;
            color: #333;
            position: relative;
            z-index: 5;
        }
        
        @media (min-width: 768px) {
            .day-number { font-size: 16px; }
        }
        
        .events-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 2px;
        }

        .work-events-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .vacation-events-wrapper {
            position: relative;
            z-index: 3;
            display: flex;
            flex-direction: column-reverse;
            gap: 2px;
            margin-top: auto;
            padding-top: 24px;
        }
        
        .event {
            font-size: 8px;
            color: white;
            padding: 2px 4px;
            border-radius: 4px;
            white-space: normal;
            overflow: hidden;
            font-weight: 500;
            line-height: 1.2;
            max-width: 100%;
        }

        .event.work-event {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2px;
            color: #2c2c2e;
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 10px;
            line-height: 1.3;
        }
        
        .event.work-event small {
            font-size: 0.8em; opacity: 0.8; display: block; font-weight: 500;
        }

        .event.vacation {
            width: 100%;
            padding: 2px 3px;
            border-radius: 2px;
            text-align: center;
            white-space: nowrap;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: #fff;
        }
        
        @media (min-width: 768px) {
            .event { font-size: 11px; }
            .event.work-event { font-size: 12px; }
            .event.vacation { padding: 4px 6px; border-radius: 4px; }
        }
        
        .upcoming-events-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 10px 0;
            gap: 10px;
            flex-wrap: wrap;
        }

        .upcoming-events-header h3 {
            margin: 0; color: #1d1d1f; font-weight: 600; font-size: 16px;
        }

        .upcoming-events-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .upcoming-events.expanded .upcoming-events-list {
            max-height: 500px;
        }
        
        .upcoming-events-header .arrow {
            transition: transform 0.3s ease; margin-left: auto;
        }

        .upcoming-events.expanded .arrow {
            transform: rotate(180deg);
        }
        
        .toggle-container {
            display: flex; align-items: center; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            padding: 15px;
            border-radius: 12px;
            width: calc(100% - 20px);
            max-width: 380px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
            margin: 10px;
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.8) translateY(-50px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .day-events-list {
            margin-top: 20px; display: flex; flex-direction: column; gap: 12px;
        }

        .day-event-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .day-event-item.vacation {
            border-left-color: #28a745;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block; margin-bottom: 6px; font-weight: 600; color: #495057; font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            min-height: 44px;
            white-space: nowrap;
        }
        
        button:hover {
            transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .button-secondary { background: #6c757d; }
        .button-danger { background: linear-gradient(135deg, #ff3b30, #dc3545); }
        
        .card {
            background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }
        
        .inventory-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;
        }
        
        .inventory-item {
            background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05); cursor: pointer;
        }
        
        .login-container {
            display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px;
        }
        
        .login-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px 20px;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }
        
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            background: #28a745;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            animation: slideInRight 0.3s ease;
            font-size: 13px;
            max-width: calc(100% - 30px);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .upcoming-events {
            background: white; border-radius: 12px; padding: 5px 15px; margin-bottom: 15px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }
        
        .month-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            background: white;
            padding: 12px 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .month-navigation h2 {
            margin: 0; color: #1d1d1f; font-weight: 600; font-size: 18px;
        }
        
        .nav-button {
            background: #667eea; color: white; border: none; width: 40px; height: 40px; border-radius: 50%;
            cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; min-height: 40px;
        }

        .chip-selector {
            display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px;
        }
        
        .chip-option {
            background: #f8f9fa; border: 2px solid #e9ecef; color: #495057; padding: 8px 12px; border-radius: 15px;
            cursor: pointer; font-size: 12px; font-weight: 500; transition: all 0.3s ease;
        }
        
        .chip-option.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white; border-color: #667eea;
        }
        
        .event-type-selector {
            display: flex; gap: 10px; margin-top: 8px; flex-wrap: wrap;
        }
        
        .event-type-option {
            flex: 1;
            background: #f8f9fa; border: 2px solid #e9ecef; color: #495057; padding: 12px 14px;
            border-radius: 12px; cursor: pointer; font-size: 13px; text-align: center; min-width: 100px;
        }
        
        .event-type-option.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white; border-color: #667eea;
        }
        
        .modal .button-group-end {
            display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; flex-wrap: wrap;
        }

        body:not(.requests-active) .container .header {
            display: none;
        }
        
        body:not(.calendar-active) .container .upcoming-events {
            display: none;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-size: 18px;
            color: #667eea;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">
        –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
    </div>

    <div id="login-screen" class="login-container" style="display: none;">
        <div class="login-form">
            <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
            <div class="form-group">
                <label for="username">Email</label>
                <input type="email" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email">
            </div>
            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <button onclick="login()" style="width: 100%;">–í–æ–π—Ç–∏</button>
        </div>
    </div>

    <div id="main-app" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∞–º–∏</h1>
                <div class="user-info">
                    <button id="reports-btn" style="display: none;">üìä <span class="btn-text">–û—Ç—á–µ—Ç</span></button>
                    <div class="user-badge" id="user-badge"></div>
                    <button class="logout-btn" onclick="logout()">–í—ã—Ö–æ–¥</button>
                </div>
            </div>
            
            <div class="upcoming-events" id="upcoming-events" onclick="toggleUpcomingEvents()">
                <div class="upcoming-events-header">
                    <h3>–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div class="upcoming-events-icons" id="upcoming-events-icons"></div>
                    <span class="arrow">‚ñº</span>
                </div>
                <div class="upcoming-events-list" id="upcoming-events-list"></div>
            </div>
            
            <div class="main-content">
                <div id="calendar" class="tab-content active">
                    <div class="month-navigation">
                        <button class="nav-button" onclick="prevMonth()">‚Äπ</button>
                        <h2 id="current-month">–ú–∞–π 2023</h2>
                        <button class="nav-button" onclick="nextMonth()">‚Ä∫</button>
                    </div>
                    
                    <div class="calendar">
                        <div class="calendar-header">–ü–Ω</div>
                        <div class="calendar-header">–í—Ç</div>
                        <div class="calendar-header">–°—Ä</div>
                        <div class="calendar-header">–ß—Ç</div>
                        <div class="calendar-header">–ü—Ç</div>
                        <div class="calendar-header">–°–±</div>
                        <div class="calendar-header">–í—Å</div>
                    </div>
                    
                    <div class="calendar-grid" id="calendar-days"></div>
                </div>
                
                <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ (teams, inventory, requests) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–µ -->
                <div id="teams" class="tab-content">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∞–º–∏</h2>
                    <button onclick="openTeamModal()" style="margin-bottom: 20px;">–î–æ–±–∞–≤–∏—Ç—å –±—Ä–∏–≥–∞–¥—É</button>
                    <div id="teams-list"></div>
                    
                    <h2 style="margin-top: 30px;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
                    <button onclick="openEmployeeModal()" style="margin-bottom: 20px;">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
                    <div id="employees-list"></div>
                </div>
                
                <div id="inventory" class="tab-content">
                    <h2>–£—á–µ—Ç —Å–∫–ª–∞–¥–∞</h2>
                    <div class="inventory-grid" id="inventory-grid"></div>
                </div>
                
                <div id="requests" class="tab-content">
                    <h2>–ó–∞—è–≤–∫–∏</h2>
                    <div id="requests-list"></div>
                </div>
            </div>
        </div>
        
        <div class="tabs" id="main-tabs">
            <button class="tab active" onclick="switchTab('calendar')"><span>üìÖ</span><span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></button>
            <button class="tab" onclick="switchTab('teams')" id="teams-tab"><span>üë•</span><span>–ë—Ä–∏–≥–∞–¥—ã</span></button>
            <button class="tab" onclick="switchTab('inventory')"><span>üì¶</span><span>–°–∫–ª–∞–¥</span></button>
            <button class="tab" onclick="switchTab('requests')" id="requests-tab"><span>üìã</span><span>–ó–∞—è–≤–∫–∏</span></button>
        </div>
    </div>
    
    <!-- –í—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–µ -->
    <div id="event-modal" class="modal">
        <div class="modal-content">
            <h2 id="event-modal-title">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</h2>
            <input type="hidden" id="event-id">
            
            <div class="form-group">
                <label>–¢–∏–ø —Å–æ–±—ã—Ç–∏—è</label>
                <div class="event-type-selector">
                    <div class="event-type-option selected" onclick="selectEventType(this, 'drilling')">‚õèÔ∏è –ë—É—Ä–µ–Ω–∏–µ</div>
                    <div class="event-type-option" onclick="selectEventType(this, 'installation')">üîß –ú–æ–Ω—Ç–∞–∂</div>
                    <div class="event-type-option" onclick="selectEventType(this, 'trip')">üöö –ü–æ–µ–∑–¥–∫–∞</div>
                    <div class="event-type-option" onclick="selectEventType(this, 'vacation')">üèñÔ∏è –û—Ç–ø—É—Å–∫</div>
                </div>
                <input type="hidden" id="event-type" value="drilling">
            </div>
            
            <div id="work-fields">
                <div class="form-group">
                    <label for="event-date">–î–∞—Ç–∞</label>
                    <input type="date" id="event-date">
                </div>
                <div class="form-group">
                    <label for="event-address">–ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞</label>
                    <input type="text" id="event-address" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞">
                </div>
                <div class="form-group">
                    <label>–ë—Ä–∏–≥–∞–¥–∞</label>
                    <div class="chip-selector" id="team-chips"></div>
                    <input type="hidden" id="event-team">
                </div>
            </div>
            
            <div id="vacation-fields" style="display: none;">
                <div class="form-group">
                    <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</label>
                    <div class="chip-selector" id="employee-chips"></div>
                    <input type="hidden" id="event-employee">
                </div>
                <div class="form-group">
                    <label for="event-start-date">–ù–∞—á–∞–ª–æ –æ—Ç–ø—É—Å–∫–∞</label>
                    <input type="date" id="event-start-date">
                </div>
                <div class="form-group">
                    <label for="event-end-date">–ö–æ–Ω–µ—Ü –æ—Ç–ø—É—Å–∫–∞</label>
                    <input type="date" id="event-end-date">
                </div>
            </div>
            
            <div class="button-group-end">
                <button class="button-secondary" onclick="closeModal('event-modal')">–û—Ç–º–µ–Ω–∞</button>
                <button id="save-event-btn" onclick="saveEvent()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="day-details-modal" class="modal">
        <div class="modal-content">
            <h2 id="day-details-title">–°–æ–±—ã—Ç–∏—è –Ω–∞ –¥–µ–Ω—å</h2>
            <div id="day-events-list"></div>
            <div class="button-group-end">
                <button class="button-secondary" onclick="closeModal('day-details-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button id="add-event-from-day-btn" onclick="addEventFromDayView()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –î—Ä—É–≥–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (team, employee, inventory, etc.) -->
    
    <script>
        // ==================================================================
        // –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö FIREBASE
        // ==================================================================
        
        // !!! –®–ê–ì 3: –í–°–¢–ê–í–¨–¢–ï –í–ê–®–£ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Æ FIREBASE –°–Æ–î–ê !!!
        const firebaseConfig = {
            apiKey: "AIz...HOLDER",
            authDomain: "YOUR-PROJECT.firebaseapp.com",
            projectId: "YOUR-PROJECT",
            storageBucket: "YOUR-PROJECT.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:12345...890"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ==================================================================
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // ==================================================================

        // –î–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ—ç—Ç–æ–º—É –º—ã –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø—É—Å—Ç—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤
        let events = [];
        let teams = [];
        let employees = [];
        let pipeTypes = [];
        let inventoryOperations = [];
        let requests = [];

        // –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ Firebase
        let currentUser = null;

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let currentDate = new Date();
        let selectedDate = null;
        let unsubscribeListeners = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –æ—Ç–ø–∏—Å–∫–∏ –æ—Ç —Å–ª—É—à–∞—Ç–µ–ª–µ–π

        // ==================================================================
        // –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø
        // ==================================================================

        // –ì–ª–∞–≤–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –≤–æ—à–µ–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        auth.onAuthStateChanged(async (user) => {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
            unsubscribeListeners.forEach(unsubscribe => unsubscribe());
            unsubscribeListeners = [];

            if (user) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª. –ü–æ–ª—É—á–∞–µ–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–∞—à–µ–π –±–∞–∑—ã `users`.
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        currentUser = { uid: user.uid, email: user.email, ...userDoc.data() };
                        console.log("–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:", currentUser.name, "–†–æ–ª—å:", currentUser.role);
                        
                        document.getElementById('loading-overlay').style.display = 'none';
                        document.getElementById('login-screen').style.display = 'none';
                        document.getElementById('main-app').style.display = 'block';
                        
                        initializeApp(); // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    } else {
                        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å –≤ Auth, –Ω–æ –Ω–µ—Ç –≤ –±–∞–∑–µ `users`
                        console.error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firestore! –í—ã—Ö–æ–¥.");
                        showNotification("–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.", "error");
                        logout();
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
                    logout();
                }
            } else {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–æ—à–µ–ª. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞.
                currentUser = null;
                document.getElementById('loading-overlay').style.display = 'none';
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('main-app').style.display = 'none';
            }
        });

        async function login() {
            const email = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (!email || !password) {
                showNotification("–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å", "error");
                return;
            }

            try {
                await auth.signInWithEmailAndPassword(email, password);
                // onAuthStateChanged —Å–¥–µ–ª–∞–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", error.message);
                showNotification("–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å", "error");
            }
        }

        function logout() {
            auth.signOut().catch(error => console.error("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:", error));
        }

        // ==================================================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ==================================================================

        function initializeApp() {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...");
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
            document.getElementById('user-badge').textContent = `${currentUser.name} (${currentUser.role === 'manager' ? '–£–ø—Ä–∞–≤–ª—è—é—â–∏–π' : '–°–æ—Ç—Ä—É–¥–Ω–∏–∫'})`;
            
            const reportsBtn = document.getElementById('reports-btn');
            const teamsTab = document.getElementById('teams-tab');
            const requestsTab = document.getElementById('requests-tab');

            if (currentUser.role === 'manager') {
                reportsBtn.style.display = 'flex';
                teamsTab.style.display = 'flex';
                requestsTab.style.display = 'flex';
            } else {
                reportsBtn.style.display = 'none';
                teamsTab.style.display = 'none';
                requestsTab.style.display = 'none';
            }
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Å–ª—É—à–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            listenToData();
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            switchTab('calendar');
        }

        function listenToData() {
            // –§—É–Ω–∫—Ü–∏—è-–æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª—É—à–∞—Ç–µ–ª—è
            const createListener = (collectionName, targetArray, renderFunction) => {
                const unsubscribe = db.collection(collectionName).onSnapshot(snapshot => {
                    targetArray.length = 0; // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤
                    snapshot.forEach(doc => {
                        targetArray.push({ id: doc.id, ...doc.data() });
                    });
                    console.log(`–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è '${collectionName}':`, targetArray.length, "–∑–∞–ø–∏—Å–µ–π");
                    if (renderFunction) renderFunction(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                }, error => {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö '${collectionName}':`, error);
                    showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${collectionName}`, 'error');
                });
                unsubscribeListeners.push(unsubscribe); // –°–æ—Ö—Ä–∞–Ω—è–µ–º, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è
            };

            // –°–æ–∑–¥–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–µ–π –¥–ª—è –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π
            createListener('events', events, () => { renderCalendar(); renderUpcomingEvents(); });
            createListener('teams', teams, renderTeams);
            createListener('employees', employees, renderEmployees);
            createListener('pipeTypes', pipeTypes, renderInventoryGrid);
            createListener('inventoryOperations', inventoryOperations, renderInventoryGrid);
            createListener('requests', requests, renderRequests);
        }

        // ==================================================================
        // –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò (–ö–ê–õ–ï–ù–î–ê–†–¨, –†–ï–ù–î–ï–†–ò–ù–ì –∏ —Ç.–¥.)
        // ==================================================================
        
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabId)?.classList.add('active');

            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`)?.classList.add('active');
            
            const body = document.body;
            body.classList.remove('calendar-active', 'requests-active');
            if (tabId === 'calendar') body.classList.add('calendar-active');
            else if (tabId === 'requests') body.classList.add('requests-active');
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            let firstDay = new Date(year, month, 1).getDay();
            firstDay = firstDay === 0 ? 6 : firstDay - 1;

            document.getElementById('current-month').textContent = getMonthName(currentDate);

            const calendarDaysEl = document.getElementById('calendar-days');
            calendarDaysEl.innerHTML = '';
            
            // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –≤ –Ω–∞—á–∞–ª–µ
            for (let i = 0; i < firstDay; i++) {
                calendarDaysEl.innerHTML += `<div class="calendar-day other-month"></div>`;
            }

            const today = formatDate(new Date());

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const formattedDate = formatDate(date);
                
                const workEventsOnDay = events.filter(e => e.date === formattedDate && ['drilling', 'installation', 'trip'].includes(e.type));
                const vacationEventsOnDay = events.filter(e => e.type === 'vacation' && e.startDate <= formattedDate && e.endDate >= formattedDate);

                let dayClasses = 'calendar-day';
                if (formattedDate === today) dayClasses += ' today';
                
                const workEventsHtml = workEventsOnDay.map(event => {
                    const teamColor = getTeamColor(event.teamId);
                    const teamNameAbbr = getTeamName(event.teamId).replace('–ë—É—Ä–∏–ª—å—â–∏–∫–∏', '–ë—É—Ä.').replace('–ú–æ–Ω—Ç–∞–∂–Ω–∏–∫–∏', '–ú–æ–Ω—Ç.').replace('–í–æ–¥–∏—Ç–µ–ª—å', '–í–æ–¥.');
                    const eventIcon = { drilling: '‚õèÔ∏è', installation: 'üîß', trip: 'üöö' }[event.type];
                    return `<div class="event work-event" style="background-color: ${teamColor};" title="${getTeamName(event.teamId)} - ${event.address}">
                                <div>${eventIcon} ${teamNameAbbr}<small>${event.address}</small></div>
                            </div>`;
                }).join('');

                const vacationEventsHtml = vacationEventsOnDay.map(event => {
                    const employeeName = getEmployeeName(event.employeeId).split(' ')[0];
                    return `<div class="event vacation" style="background-color: #34c759;" title="${getEmployeeName(event.employeeId)}">üèñÔ∏è ${employeeName}</div>`;
                }).join('');

                calendarDaysEl.innerHTML += `
                    <div class="${dayClasses}" onclick="openDayDetailsModal('${formattedDate}')">
                        <div class="work-events-wrapper">${workEventsHtml}</div>
                        <div class="day-number">${day}</div>
                        <div class="events-container">
                            <div class="vacation-events-wrapper">${vacationEventsHtml}</div>
                        </div>
                    </div>
                `;
            }
             // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –≤ –∫–æ–Ω—Ü–µ
            const totalCells = firstDay + daysInMonth;
            const remainingCells = (totalCells % 7 === 0) ? 0 : 7 - (totalCells % 7);
            for (let i = 0; i < remainingCells; i++) {
                calendarDaysEl.innerHTML += `<div class="calendar-day other-month"></div>`;
            }
        }

        function renderUpcomingEvents() { /* ... –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */ }
        function toggleUpcomingEvents() { /* ... –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */ }

        function prevMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        // ==================================================================
        // –†–ê–ë–û–¢–ê –° –°–û–ë–´–¢–ò–Ø–ú–ò (CRUD)
        // ==================================================================

        function openDayDetailsModal(date) {
            selectedDate = date;
            document.getElementById('day-details-title').textContent = `–°–æ–±—ã—Ç–∏—è –Ω–∞ ${date.split('-').reverse().join('.')}`;
            
            const dayEvents = events.filter(e => (e.date === date) || (e.type === 'vacation' && e.startDate <= date && e.endDate >= date));
            const listEl = document.getElementById('day-events-list');

            if (dayEvents.length === 0) {
                listEl.innerHTML = '<div style="color: #6c757d; text-align: center; padding: 20px 0;">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π.</div>';
            } else {
                 listEl.innerHTML = dayEvents.map(event => {
                    const actionsHtml = currentUser.role === 'manager' 
                        ? `<button class="button-secondary" onclick="editEvent('${event.id}')">–ò–∑–º.</button><button class="button-danger" onclick="deleteEvent('${event.id}')">–£–¥–ª.</button>`
                        : '';
                    
                    if (event.type === 'vacation') {
                        return `<div class="day-event-item vacation"><div><strong>üèñÔ∏è –û—Ç–ø—É—Å–∫</strong><p>${getEmployeeName(event.employeeId)}</p></div><div>${actionsHtml}</div></div>`;
                    } else {
                        const teamColor = getTeamColor(event.teamId);
                        const eventTitle = { drilling: '‚õèÔ∏è –ë—É—Ä–µ–Ω–∏–µ', installation: 'üîß –ú–æ–Ω—Ç–∞–∂', trip: 'üöö –ü–æ–µ–∑–¥–∫–∞' }[event.type];
                        return `<div class="day-event-item" style="border-left-color: ${teamColor}"><div><strong>${eventTitle}</strong><p>${getTeamName(event.teamId)} - ${event.address}</p></div><div>${actionsHtml}</div></div>`;
                    }
                }).join('');
            }
            
            document.getElementById('add-event-from-day-btn').style.display = currentUser.role === 'manager' ? 'inline-block' : 'none';
            openModal('day-details-modal');
        }

        async function saveEvent() {
            const eventId = document.getElementById('event-id').value;
            const isEditing = !!eventId;
            const type = document.getElementById('event-type').value;
            let newEventData;

            if (['drilling', 'installation', 'trip'].includes(type)) {
                newEventData = {
                    type: type,
                    date: document.getElementById('event-date').value,
                    address: document.getElementById('event-address').value.trim(),
                    teamId: document.getElementById('event-team').value,
                };
                if (!newEventData.date || !newEventData.address || !newEventData.teamId) {
                    return showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è —Ä–∞–±–æ—á–µ–≥–æ —Å–æ–±—ã—Ç–∏—è', 'error');
                }
            } else if (type === 'vacation') {
                newEventData = {
                    type: 'vacation',
                    startDate: document.getElementById('event-start-date').value,
                    endDate: document.getElementById('event-end-date').value,
                    employeeId: document.getElementById('event-employee').value,
                };
                if (!newEventData.startDate || !newEventData.endDate || !newEventData.employeeId) {
                    return showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—É—Å–∫–∞', 'error');
                }
            }

            try {
                if (isEditing) {
                    await db.collection('events').doc(eventId).update(newEventData);
                    showNotification('–°–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
                } else {
                    await db.collection('events').add(newEventData);
                    showNotification('–°–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
                }
                closeModal('event-modal');
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è:", error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è', 'error');
            }
        }
        
        async function deleteEvent(eventId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ?')) return;
            try {
                await db.collection('events').doc(eventId).delete();
                showNotification('–°–æ–±—ã—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ');
                closeModal('day-details-modal');
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è:", error);
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            }
        }

        // ==================================================================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (—Ö–µ–ª–ø–µ—Ä—ã)
        // ==================================================================

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            if (type === 'error') {
                notification.style.background = '#ff3b30';
            }
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        function formatDate(date) {
            const d = new Date(date);
            let month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear();
            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;
            return [year, month, day].join('-');
        }
        
        function getMonthName(date) {
            return date.toLocaleString('ru-RU', { month: 'long', year: 'numeric' });
        }

        function getTeamName(id) {
            const team = teams.find(t => t.id === id);
            return team ? team.name : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –±—Ä–∏–≥–∞–¥–∞";
        }
        
        function getTeamColor(id) {
            const team = teams.find(t => t.id === id);
            return team ? team.color : "#cccccc";
        }
        
        function getEmployeeName(id) {
            const employee = employees.find(e => e.id === id);
            return employee ? employee.name : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫";
        }
        
        function openModal(modalId) { document.getElementById(modalId).style.display = 'flex'; }
        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
        
        function editEvent(eventId) { /* ... –∫–æ–¥ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã ... */ }
        function addEventFromDayView() { /* ... –∫–æ–¥ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ... */ }
        function selectEventType(element, type) { /* ... –∫–æ–¥ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è ... */ }
        function renderTeams() { /* ... –∫–æ–¥ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –±—Ä–∏–≥–∞–¥ ... */ }
        function renderEmployees() { /* ... –∫–æ–¥ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ ... */ }
        function renderInventoryGrid() { /* ... –∫–æ–¥ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å–∫–ª–∞–¥–∞ ... */ }
        function renderRequests() { /* ... –∫–æ–¥ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∑–∞—è–≤–æ–∫ ... */ }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è Enter –¥–ª—è –ø–æ–ª—è –ø–∞—Ä–æ–ª—è
        document.getElementById('password').addEventListener('keypress', e => { if (e.key === 'Enter') login(); });
        
        // –¢—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–π JS –∫–æ–¥ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (openTeamModal, saveTeam –∏ —Ç.–¥.),
        // –∫–æ—Ç–æ—Ä—ã–π —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Firestore.
        // –Ø –æ—Å—Ç–∞–≤–∏–ª –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø.
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    
    <!-- PWA Meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–ë—Ä–∏–≥–∞–¥—ã">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
    <link rel="manifest" href="manifest.json">
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#667eea">
    
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∞–º–∏ –∏ —Å–∫–ª–∞–¥–æ–º</title>

    <style>
        :root { --tab-bar-height: 70px; }
        * { box-sizing: border-box; }
        html { width: 100%; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        body { margin: 0; padding: 0; width: 100%; height: 100%; overflow-x: hidden; position: relative; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; color: #1d1d1f; font-size: 14px; padding-bottom: calc(var(--tab-bar-height) + env(safe-area-inset-bottom)); }
        *:not(script):not(style) { -webkit-user-select: none; user-select: none; }
        input, textarea, select { -webkit-user-select: text; user-select: text; }
        .container { max-width: 100%; margin: 0 auto; padding: 10px; box-sizing: border-box; position: relative; }
        @media (min-width: 768px) { .container { max-width: 1200px; padding: 20px; } body { font-size: 16px; } }
        .header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); display: none; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; position: relative; }
        @media (min-width: 768px) { .header { border-radius: 20px; padding: 20px; margin-bottom: 20px; } }
        .header h1 { margin: 0; color: #1d1d1f; font-size: 16px; font-weight: 600; flex-grow: 1; min-width: 120px; }
        @media (min-width: 480px) { .header h1 { font-size: 20px; } }
        @media (min-width: 768px) { .header h1 { font-size: 28px; } }
        .user-info { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .user-badge { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 6px 12px; border-radius: 15px; font-size: 12px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px; }
        @media (min-width: 768px) { .user-badge { padding: 8px 16px; border-radius: 20px; font-size: 14px; max-width: none; } }
        #reports-btn { background: #17a2b8; color: white; border: none; padding: 8px 12px; border-radius: 15px; font-size: 13px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 5px; min-height: 40px; }
        .logout-btn { background: #ff3b30; color: white; border: none; padding: 8px 14px; border-radius: 15px; cursor: pointer; font-size: 13px; transition: all 0.3s ease; min-height: 40px; }
        @media (min-width: 768px) { .logout-btn, #reports-btn { padding: 10px 18px; border-radius: 20px; font-size: 14px; } }
        .main-content { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); overflow: hidden; }
        @media (min-width: 768px) { .main-content { border-radius: 20px; } }
        .tabs { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--tab-bar-height); display: grid; grid-template-columns: repeat(4, 1fr); background: rgba(248, 249, 250, 0.7); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-top: 1px solid rgba(0, 0, 0, 0.1); z-index: 100; padding-bottom: env(safe-area-inset-bottom); }
        .tab { padding: 4px; text-align: center; cursor: pointer; border: none; background: transparent; font-size: 11px; font-weight: 500; color: #6c757d; transition: all 0.3s ease; position: relative; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; height: 100%; border-top: 3px solid transparent; }
        .tab span:first-child { font-size: 20px; }
        .tab.active { color: #667eea; border-top-color: #667eea; }
        .tab-content { display: none; padding: 15px; animation: fadeIn 0.3s ease; }
        @media (min-width: 768px) { .tab-content { padding: 30px; } }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #e9ecef; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); margin-bottom: 1px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #e9ecef; border-radius: 0 0 8px 8px; overflow: hidden; touch-action: pan-y; }
        .calendar-header { text-align: center; font-weight: 600; padding: 10px 4px; background: #667eea; color: white; font-size: 12px; }
        .calendar-day { background: white; padding: 2px; aspect-ratio: 1 / 1.6; overflow: hidden; position: relative; cursor: pointer; transition: background 0.2s ease; display: flex; flex-direction: column; }
        .calendar-day:hover { transform: scale(1.02); z-index: 10; }
        .calendar-day.today { box-shadow: inset 0 0 0 2px #007aff; z-index: 50; position: relative; }
        .calendar-day.other-month { background: #f8f9fa; color: #adb5bd; cursor: default; }
        .day-number { font-weight: 600; font-size: 10px; line-height: 1; align-self: flex-start; padding: 2px; color: #333; position: relative; z-index: 5; }
        .events-container { flex-grow: 1; display: flex; flex-direction: column; justify-content: flex-end; position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 2px; }
        .work-events-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; }
        .vacation-events-wrapper { position: relative; z-index: 3; display: flex; flex-direction: column-reverse; gap: 2px; margin-top: auto; padding-top: 24px; }
        .event { font-size: 8px; color: white; padding: 2px 4px; border-radius: 4px; white-space: normal; overflow: hidden; font-weight: 500; line-height: 1.2; max-width: 100%; }
        .event.work-event { flex-grow: 1; display: flex; align-items: center; justify-content: center; text-align: center; padding: 2px; color: #2c2c2e; font-weight: 600; overflow: hidden; text-overflow: ellipsis; font-size: 10px; line-height: 1.3; }
        .event.work-event small { font-size: 0.8em; opacity: 0.8; display: block; font-weight: 500; }
        .event.vacation { width: 100%; padding: 2px 3px; border-radius: 2px; text-align: center; white-space: nowrap; text-overflow: ellipsis; display: flex; align-items: center; justify-content: center; gap: 4px; color: #fff; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .modal-content { background: white; padding: 15px; border-radius: 12px; width: calc(100% - 20px); max-width: 420px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: modalSlideIn 0.3s ease; margin: 10px; }
        @keyframes modalSlideIn { from { opacity: 0; transform: scale(0.8) translateY(-50px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .day-events-list { margin-top: 20px; display: flex; flex-direction: column; gap: 12px; }
        .day-event-item { background: #f8f9fa; border-radius: 8px; padding: 12px; border-left: 4px solid #667eea; display: flex; justify-content: space-between; align-items: center; gap: 10px; flex-wrap: wrap; }
        .day-event-item.vacation { border-left-color: #28a745; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: #495057; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px 14px; border: 2px solid #e9ecef; border-radius: 10px; box-sizing: border-box; font-size: 14px; transition: all 0.3s ease; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        button { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 18px; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s ease; min-height: 44px; white-space: nowrap; }
        button:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); }
        .button-secondary { background: #6c757d; }
        .button-danger { background: linear-gradient(135deg, #ff3b30, #dc3545); }
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05); }
        .inventory-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .login-form { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 30px 20px; width: 100%; max-width: 350px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2); }
        .notification { position: fixed; top: 15px; right: 15px; background: #28a745; color: white; padding: 12px 16px; border-radius: 8px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2); z-index: 1001; animation: slideInRight 0.3s ease; font-size: 13px; max-width: calc(100% - 30px); }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .upcoming-events { background: white; border-radius: 12px; padding: 5px 15px; margin-bottom: 15px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05); }
        .upcoming-events-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 10px 0; gap: 10px; flex-wrap: wrap; }
        .upcoming-events-header h3 { margin: 0; color: #1d1d1f; font-weight: 600; font-size: 16px; }
        .upcoming-events-list { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .upcoming-events.expanded .upcoming-events-list { max-height: 500px; }
        .upcoming-events-header .arrow { transition: transform 0.3s ease; margin-left: auto; }
        .upcoming-events.expanded .arrow { transform: rotate(180deg); }
        .month-navigation { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: white; padding: 12px 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); }
        .month-navigation h2 { margin: 0; color: #1d1d1f; font-weight: 600; font-size: 18px; }
        .nav-button { background: #667eea; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; min-height: 40px; }
        .chip-selector { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .chip-option { background: #f8f9fa; border: 2px solid #e9ecef; color: #495057; padding: 8px 12px; border-radius: 15px; cursor: pointer; font-size: 12px; font-weight: 500; transition: all 0.3s ease; }
        .chip-option.selected { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-color: #667eea; }
        .event-type-selector, .team-type-selector, .role-selector { display: flex; gap: 10px; margin-top: 8px; flex-wrap: wrap; }
        .event-type-option, .team-type-option, .role-option { flex: 1; background: #f8f9fa; border: 2px solid #e9ecef; color: #495057; padding: 12px 14px; border-radius: 12px; cursor: pointer; font-size: 13px; text-align: center; min-width: 100px; }
        .event-type-option.selected, .team-type-option.selected, .role-option.selected { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-color: #667eea; }
        .modal .button-group-end { display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; flex-wrap: wrap; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 9999; font-size: 18px; color: #667eea; font-weight: 500; transition: opacity 0.3s ease; }
    </style>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
      import { getFirestore, collection, onSnapshot, doc, getDoc, addDoc, updateDoc, deleteDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
      import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
    
      const firebaseConfig = {
        apiKey: "AIzaSyCsWfzOoerj6TiM2am46reV42CQ0OE7TM8",
        authDomain: "calendarsaturit.firebaseapp.com",
        projectId: "calendarsaturit",
        storageBucket: "calendarsaturit.appspot.com",
        messagingSenderId: "286002422636",
        appId: "1:286002422636:web:58b626bffddfb64b060949",
        measurementId: "G-8GC7ZJ94TW"
      };
    
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);
    
      window.db = db;
      window.auth = auth;
      window.firebase = {
          db: { collection, onSnapshot, doc, getDoc, addDoc, updateDoc, deleteDoc, setDoc },
          auth: { onAuthStateChanged, signInWithEmailAndPassword, signOut }
      };
    
      document.addEventListener('DOMContentLoaded', () => {
          setupAuthListener();
      });
    </script>
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <div id="login-screen" class="login-container" style="display: none;">
        <div class="login-form">
            <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
            <div class="form-group"><label for="username">Email</label><input type="email" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email"></div>
            <div class="form-group"><label for="password">–ü–∞—Ä–æ–ª—å</label><input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"></div>
            <button onclick="login()" style="width: 100%;">–í–æ–π—Ç–∏</button>
        </div>
    </div>

    <div id="main-app" style="display: none;">
        <div class="container">
            <div class="header">
                <h1 id="header-title"></h1>
                <div class="user-info">
                    <button id="reports-btn" style="display: none;" onclick="generateQuickReport()">üìä <span class="btn-text">–û—Ç—á–µ—Ç</span></button>
                    <div class="user-badge" id="user-badge"></div>
                    <button class="logout-btn" onclick="logout()">–í—ã—Ö–æ–¥</button>
                </div>
            </div>
            <div class="upcoming-events" id="upcoming-events" onclick="toggleUpcomingEvents()"><div class="upcoming-events-header"><h3>–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3><div id="upcoming-events-icons"></div><span class="arrow">‚ñº</span></div><div class="upcoming-events-list" id="upcoming-events-list"></div></div>
            <div class="main-content">
                <div id="calendar" class="tab-content"><div class="month-navigation"><button class="nav-button" onclick="prevMonth()">‚Äπ</button><h2 id="current-month"></h2><button class="nav-button" onclick="nextMonth()">‚Ä∫</button></div><div class="calendar"><div class="calendar-header">–ü–Ω</div><div class="calendar-header">–í—Ç</div><div class="calendar-header">–°—Ä</div><div class="calendar-header">–ß—Ç</div><div class="calendar-header">–ü—Ç</div><div class="calendar-header">–°–±</div><div class="calendar-header">–í—Å</div></div><div class="calendar-grid" id="calendar-days"></div></div>
                <div id="teams" class="tab-content"><h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∞–º–∏</h2><button onclick="openTeamModal()">–î–æ–±–∞–≤–∏—Ç—å –±—Ä–∏–≥–∞–¥—É</button><div id="teams-list" style="margin-top: 20px;"></div><h2 style="margin-top:30px;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2><button onclick="openEmployeeModal()">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button><div id="employees-list" style="margin-top: 20px;"></div></div>
                <div id="inventory" class="tab-content"><h2>–£—á–µ—Ç —Å–∫–ª–∞–¥–∞</h2><div class="inventory-grid" id="inventory-grid"></div></div>
                <div id="requests" class="tab-content"><h2>–ó–∞—è–≤–∫–∏</h2><div id="requests-list"></div></div>
            </div>
        </div>
        <div class="tabs" id="main-tabs">
            <button class="tab" onclick="switchTab('calendar')"><span>üìÖ</span><span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></button>
            <button class="tab" onclick="switchTab('teams')" id="teams-tab"><span>üë•</span><span>–ë—Ä–∏–≥–∞–¥—ã</span></button>
            <button class="tab" onclick="switchTab('inventory')"><span>üì¶</span><span>–°–∫–ª–∞–¥</span></button>
            <button class="tab" onclick="switchTab('requests')" id="requests-tab"><span>üìã</span><span>–ó–∞—è–≤–∫–∏</span></button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JS, —á—Ç–æ–±—ã –Ω–µ –∑–∞–≥—Ä–æ–º–æ–∂–¥–∞—Ç—å HTML -->

    <script>
    // ==================================================================
    // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
    // ==================================================================
    let events = [], teams = [], employees = [], pipeTypes = [], inventoryOperations = [], requests = [];
    let currentUser = null, currentDate = new Date(), selectedDate = null, unsubscribeListeners = [], selectedInventoryItem = null, editedEntity = null;

    // ==================================================================
    // –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // ==================================================================
    function setupAuthListener() {
        window.firebase.auth.onAuthStateChanged(window.auth, async (user) => {
            unsubscribeListeners.forEach(unsubscribe => unsubscribe());
            unsubscribeListeners = [];
            const loadingOverlay = document.getElementById('loading-overlay');
            if (user) {
                try {
                    const userDocRef = window.firebase.db.doc(window.db, 'users', user.uid);
                    const userDoc = await window.firebase.db.getDoc(userDocRef);
                    if (!userDoc.exists()) throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firestore!");
                    currentUser = { uid: user.uid, email: user.email, ...userDoc.data() };
                    await initializeApp();
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", error);
                    showNotification(error.message, "error");
                    logout();
                }
            } else {
                currentUser = null;
                document.getElementById('main-app').style.display = 'none';
                document.getElementById('login-screen').style.display = 'flex';
                loadingOverlay.style.opacity = '0';
                setTimeout(() => loadingOverlay.style.display = 'none', 300);
            }
        });
    }

    async function login() {
        const email = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        if (!email || !password) return showNotification("–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å", "error");
        try { await window.firebase.auth.signInWithEmailAndPassword(window.auth, email, password); } 
        catch (error) { showNotification("–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å", "error"); }
    }

    function logout() {
        window.firebase.auth.signOut(window.auth).catch(error => console.error("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:", error));
    }

    async function initializeApp() {
        document.getElementById('main-app').style.display = 'block';
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('user-badge').textContent = `${currentUser.name} (${currentUser.role === 'manager' ? '–£–ø—Ä–∞–≤–ª—è—é—â–∏–π' : '–°–æ—Ç—Ä—É–¥–Ω–∏–∫'})`;
        const isManager = currentUser.role === 'manager';
        document.getElementById('reports-btn').style.display = isManager ? 'flex' : 'none';
        document.getElementById('teams-tab').style.display = isManager ? 'flex' : 'none';
        document.getElementById('requests-tab').style.display = 'none'; // –ó–∞—è–≤–∫–∏ –ø–æ–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω—ã
        
        await listenToData();
        switchTab('calendar');
        const loadingOverlay = document.getElementById('loading-overlay');
        loadingOverlay.style.opacity = '0';
        setTimeout(() => loadingOverlay.style.display = 'none', 300);
    }

    function listenToData() {
        const collectionsToListen = ['events', 'teams', 'employees', 'pipeTypes', 'inventoryOperations', 'requests'];
        const renderAll = () => {
            renderCalendar(); 
            // renderUpcomingEvents(); 
            renderTeams();
            renderEmployees();
            renderInventoryGrid();
            // renderRequests();
        };

        collectionsToListen.forEach(collectionName => {
            const collectionRef = window.firebase.db.collection(window.db, collectionName);
            const unsubscribe = window.firebase.db.onSnapshot(collectionRef, (snapshot) => {
                const targetArray = window[collectionName]; 
                if (targetArray) {
                    targetArray.length = 0; 
                    snapshot.forEach(doc => targetArray.push({ id: doc.id, ...doc.data() }));
                    renderAll(); 
                }
            }, (error) => console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö '${collectionName}':`, error));
            unsubscribeListeners.push(unsubscribe);
        });
    }
    
    // ==================================================================
    // –†–ï–ù–î–ï–† –ò–ù–¢–ï–†–§–ï–ô–°–ê (–û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò)
    // ==================================================================
    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        let firstDay = new Date(year, month, 1).getDay();
        firstDay = firstDay === 0 ? 6 : firstDay - 1;
        document.getElementById('current-month').textContent = getMonthName(currentDate);
        const calendarDaysEl = document.getElementById('calendar-days');
        calendarDaysEl.innerHTML = '';
        for (let i = 0; i < firstDay; i++) calendarDaysEl.innerHTML += `<div class="calendar-day other-month"></div>`;
        const today = formatDate(new Date());
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            const formattedDate = formatDate(date);
            const workEventsOnDay = events.filter(e => e.date === formattedDate && ['drilling', 'installation', 'trip'].includes(e.type));
            const vacationEventsOnDay = events.filter(e => e.type === 'vacation' && e.startDate <= formattedDate && e.endDate >= formattedDate);
            let dayClasses = 'calendar-day';
            if (formattedDate === today) dayClasses += ' today';
            const workEventsHtml = workEventsOnDay.map(event => `<div class="event work-event" style="background-color: ${getTeamColor(event.teamId)};" title="${getTeamName(event.teamId)}">${getTeamName(event.teamId).split(' ')[0]}</div>`).join('');
            const vacationEventsHtml = vacationEventsOnDay.map(event => `<div class="event vacation" style="background-color: #34c759;" title="${getEmployeeName(event.employeeId)}">üèñÔ∏è ${getEmployeeName(event.employeeId).split(' ')[0]}</div>`).join('');
            calendarDaysEl.innerHTML += `<div class="${dayClasses}" onclick="openDayDetailsModal('${formattedDate}')"><div class="work-events-wrapper">${workEventsHtml}</div><div class="day-number">${day}</div><div class="events-container"><div class="vacation-events-wrapper">${vacationEventsHtml}</div></div></div>`;
        }
        const totalCells = firstDay + daysInMonth;
        const remainingCells = (totalCells % 7 === 0) ? 0 : 7 - (totalCells % 7);
        for (let i = 0; i < remainingCells; i++) calendarDaysEl.innerHTML += `<div class="calendar-day other-month"></div>`;
    }

    function renderTeams() {
        const list = document.getElementById('teams-list');
        if (!list) return;
        list.innerHTML = teams.map(team => `
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <div>
                        <h3 style="margin:0 0 5px 0;">${team.name}</h3>
                        <span style="font-size:12px; color:#6c757d;">${team.type}</span>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="button-secondary" style="padding:8px 12px; min-height:0;" onclick="openTeamModal('${team.id}')">–ò–∑–º.</button>
                        <button class="button-danger" style="padding:8px 12px; min-height:0;" onclick="deleteEntity('teams', '${team.id}')">–£–¥–ª.</button>
                    </div>
                </div>
            </div>
        `).join('') || '<p>–ë—Ä–∏–≥–∞–¥ –ø–æ–∫–∞ –Ω–µ—Ç.</p>';
    }

    function renderEmployees() {
        const list = document.getElementById('employees-list');
        if (!list) return;
        list.innerHTML = employees.map(emp => `
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <p style="margin:0; font-weight:600;">${emp.name}</p>
                        <p style="margin:4px 0 0; font-size:12px; color:#6c757d;">${emp.role}</p>
                    </div>
                     <div style="display:flex; gap:10px;">
                        <button class="button-secondary" style="padding:8px 12px; min-height:0;" onclick="openEmployeeModal('${emp.id}')">–ò–∑–º.</button>
                        <button class="button-danger" style="padding:8px 12px; min-height:0;" onclick="deleteEntity('employees', '${emp.id}')">–£–¥–ª.</button>
                    </div>
                </div>
            </div>
        `).join('') || '<p>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>';
    }

    // ==================================================================
    // –°–ö–õ–ê–î
    // ==================================================================
    function renderInventoryGrid() { /* –ö–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */ }
    function calculateCurrentAmount(itemId) { /* –ö–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */ }
    function openInventoryHistoryModal(itemId, itemName, isFuel) { /* –ö–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */ }
    function openInventoryOperationModal() { /* –ö–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */ }
    function selectOperationType(type) { /* –ö–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */ }
    async function saveInventoryOperation() { /* –ö–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */ }
    
    // ==================================================================
    // –£–ü–†–ê–í–õ–ï–ù–ò–ï –ë–†–ò–ì–ê–î–ê–ú–ò –ò –°–û–¢–†–£–î–ù–ò–ö–ê–ú–ò
    // ==================================================================
    function openTeamModal(teamId = null) {
        editedEntity = teamId ? teams.find(t => t.id === teamId) : {};
        const isEditing = !!teamId;
        createModal('team-modal', {
            title: isEditing ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∏–≥–∞–¥—É' : '–î–æ–±–∞–≤–∏—Ç—å –±—Ä–∏–≥–∞–¥—É',
            body: `
                <div class="form-group"><label for="team-name">–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="team-name" value="${editedEntity.name || ''}"></div>
                <div class="form-group"><label>–¢–∏–ø</label><div class="team-type-selector" id="modal-team-type"></div></div>
                <div class="form-group"><label>–¶–≤–µ—Ç</label><input type="color" id="team-color" value="${editedEntity.color || '#a7c7e7'}" style="width:100%; height:40px;"></div>
            `,
            footer: `<button class="button-secondary" onclick="closeModal('team-modal')">–û—Ç–º–µ–Ω–∞</button><button onclick="saveTeam()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>`
        });
        const teamTypes = { drillers: '–ë—É—Ä–∏–ª—å—â–∏–∫–∏', installers: '–ú–æ–Ω—Ç–∞–∂–Ω–∏–∫–∏', drivers: '–í–æ–¥–∏—Ç–µ–ª–∏' };
        document.getElementById('modal-team-type').innerHTML = Object.keys(teamTypes).map(key => 
            `<button class="team-type-option ${editedEntity.type === key ? 'selected' : ''}" onclick="selectModalOption(this, 'team-type-option', '#modal-team-type-value', '${key}')">${teamTypes[key]}</button>`
        ).join('') + `<input type="hidden" id="modal-team-type-value" value="${editedEntity.type || 'drillers'}">`;
    }

    async function saveTeam() {
        const teamData = {
            name: document.getElementById('team-name').value.trim(),
            type: document.getElementById('modal-team-type-value').value,
            color: document.getElementById('team-color').value,
        };
        if (!teamData.name) return showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±—Ä–∏–≥–∞–¥—ã', 'error');
        await saveEntity('teams', teamData);
        closeModal('team-modal');
    }

    function openEmployeeModal(empId = null) {
        editedEntity = empId ? employees.find(e => e.id === empId) : {};
        const isEditing = !!empId;
        createModal('employee-modal', {
            title: isEditing ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞' : '–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞',
            body: `
                <div class="form-group"><label for="employee-name">–§–ò–û</label><input type="text" id="employee-name" value="${editedEntity.name || ''}"></div>
                <div class="form-group"><label>–†–æ–ª—å</label><div class="role-selector" id="modal-role"></div></div>
            `,
            footer: `<button class="button-secondary" onclick="closeModal('employee-modal')">–û—Ç–º–µ–Ω–∞</button><button onclick="saveEmployee()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>`
        });
        const roles = { manager: '–£–ø—Ä–∞–≤–ª—è—é—â–∏–π', employee: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫' };
        document.getElementById('modal-role').innerHTML = Object.keys(roles).map(key => 
            `<button class="role-option ${editedEntity.role === key ? 'selected' : ''}" onclick="selectModalOption(this, 'role-option', '#modal-role-value', '${key}')">${roles[key]}</button>`
        ).join('') + `<input type="hidden" id="modal-role-value" value="${editedEntity.role || 'employee'}">`;
    }

    async function saveEmployee() {
        const employeeData = {
            name: document.getElementById('employee-name').value.trim(),
            role: document.getElementById('modal-role-value').value,
        };
        if (!employeeData.name) return showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', 'error');
        await saveEntity('employees', employeeData);
        closeModal('employee-modal');
    }

    async function saveEntity(collectionName, data) {
        try {
            if (editedEntity && editedEntity.id) {
                await window.firebase.db.updateDoc(window.firebase.db.doc(window.db, collectionName, editedEntity.id), data);
                showNotification('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
            } else {
                await window.firebase.db.addDoc(window.firebase.db.collection(window.db, collectionName), data);
                showNotification('–î–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
            }
        } catch (error) { showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error'); console.error(error); }
    }
    
    async function deleteEntity(collectionName, docId) {
        if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) return;
        try {
            await window.firebase.db.deleteDoc(window.firebase.db.doc(window.db, collectionName, docId));
            if (collectionName === 'events') {
                closeModal('day-details-modal');
            }
            showNotification('–ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞');
        } catch (error) { showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error'); }
    }

    // ==================================================================
    // –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–û–ë–´–¢–ò–Ø–ú–ò (–ö–ê–õ–ï–ù–î–ê–†–¨) -- –ù–û–í–´–ô –ë–õ–û–ö
    // ==================================================================
    function openDayDetailsModal(date) {
        selectedDate = date;
        const workEventsOnDay = events.filter(e => e.date === date && ['drilling', 'installation', 'trip'].includes(e.type));
        const vacationEventsOnDay = events.filter(e => e.type === 'vacation' && e.startDate <= date && e.endDate >= date);
        const allEventsOnDay = [...workEventsOnDay, ...vacationEventsOnDay].sort((a,b) => (a.teamId || a.employeeId).localeCompare(b.teamId || b.employeeId));

        const [y, m, d] = date.split('-').map(Number);
        const displayDate = new Date(y, m - 1, d).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });

        const eventsHtml = allEventsOnDay.length > 0 ? allEventsOnDay.map(event => {
            const isVacation = event.type === 'vacation';
            const title = isVacation ? `–û—Ç–ø—É—Å–∫: ${getEmployeeName(event.employeeId)}` : `${getEventTypeName(event.type)}: ${getTeamName(event.teamId)}`;
            const details = isVacation ? `c ${formatDate(new Date(event.startDate))} –ø–æ ${formatDate(new Date(event.endDate))}` : event.address;
            const adminButtons = currentUser.role === 'manager' ? `
                <div style="display:flex; gap:8px; margin-left:auto; align-items:center;">
                    <button style="padding:6px 10px; font-size:12px; min-height:0;" class="button-secondary" onclick="openEventModal('${event.id}')">‚úèÔ∏è</button>
                    <button style="padding:6px 10px; font-size:12px; min-height:0;" class="button-danger" onclick="deleteEntity('events', '${event.id}')">üóëÔ∏è</button>
                </div>` : '';
            return `<div class="day-event-item ${isVacation ? 'vacation' : ''}">
                        <div><strong style="display:block;">${title}</strong><small style="color:#6c757d;">${details || ' '}</small></div>
                        ${adminButtons}
                    </div>`;
        }).join('') : '<p style="text-align:center; color:#6c757d; padding: 20px 0;">–°–æ–±—ã—Ç–∏–π –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ.</p>';

        let footerButtons = `<button class="button-secondary" onclick="closeModal('day-details-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>`;
        if (currentUser.role === 'manager') {
            footerButtons += `<button onclick="openEventModal()">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>`;
        }
        
        createModal('day-details-modal', {
            title: `–°–æ–±—ã—Ç–∏—è –Ω–∞ ${displayDate}`,
            body: `<div class="day-events-list">${eventsHtml}</div>`,
            footer: footerButtons
        });
    }

    function openEventModal(eventId = null) {
        editedEntity = eventId ? events.find(e => e.id === eventId) : null;
        const isEditing = !!editedEntity;
        const eventData = editedEntity || {};

        const eventTypes = { drilling: '–ë—É—Ä–µ–Ω–∏–µ', installation: '–ú–æ–Ω—Ç–∞–∂', trip: '–ü–æ–µ–∑–¥–∫–∞', vacation: '–û—Ç–ø—É—Å–∫' };
        const eventTypeOptions = Object.entries(eventTypes).map(([key, value]) => 
            `<button class="event-type-option ${(eventData.type || 'drilling') === key ? 'selected' : ''}" 
                     onclick="selectModalOption(this, 'event-type-option', '#event-type', '${key}'); toggleEventFormFields('${key}');">
                ${value}
            </button>`
        ).join('');
        
        const teamsOptions = teams.map(t => `<option value="${t.id}" ${eventData.teamId === t.id ? 'selected' : ''}>${t.name}</option>`).join('');
        const employeesOptions = employees.map(e => `<option value="${e.id}" ${eventData.employeeId === e.id ? 'selected' : ''}>${e.name}</option>`).join('');

        const body = `
            <div class="form-group">
                <label>–¢–∏–ø —Å–æ–±—ã—Ç–∏—è</label>
                <div class="event-type-selector">${eventTypeOptions}</div>
                <input type="hidden" id="event-type" value="${eventData.type || 'drilling'}">
            </div>
            
            <div id="work-event-fields">
                <div class="form-group"><label for="event-date">–î–∞—Ç–∞</label><input type="date" id="event-date" value="${eventData.date || selectedDate}"></div>
                <div class="form-group"><label for="event-team">–ë—Ä–∏–≥–∞–¥–∞</label><select id="event-team">${teamsOptions}</select></div>
                <div class="form-group"><label for="event-address">–ê–¥—Ä–µ—Å</label><input type="text" id="event-address" value="${eventData.address || ''}" placeholder="—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1"></div>
            </div>

            <div id="vacation-event-fields" style="display:none;">
                <div class="form-group"><label for="event-employee">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</label><select id="event-employee">${employeesOptions}</select></div>
                <div class="form-group"><label for="event-start-date">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label><input type="date" id="event-start-date" value="${eventData.startDate || selectedDate}"></div>
                <div class="form-group"><label for="event-end-date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label><input type="date" id="event-end-date" value="${eventData.endDate || selectedDate}"></div>
            </div>
        `;
        
        createModal('event-modal', {
            title: isEditing ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ' : '–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ',
            body: body,
            footer: `<button class="button-secondary" onclick="closeModal('event-modal')">–û—Ç–º–µ–Ω–∞</button><button onclick="saveEvent()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>`
        });
        
        toggleEventFormFields(eventData.type || 'drilling');
        closeModal('day-details-modal');
    }

    function toggleEventFormFields(type) {
        const workFields = document.getElementById('work-event-fields');
        const vacationFields = document.getElementById('vacation-event-fields');
        if (type === 'vacation') {
            workFields.style.display = 'none';
            vacationFields.style.display = 'block';
        } else {
            workFields.style.display = 'block';
            vacationFields.style.display = 'none';
        }
    }

    async function saveEvent() {
        const type = document.getElementById('event-type').value;
        let eventData = { type };

        if (type === 'vacation') {
            eventData.employeeId = document.getElementById('event-employee').value;
            eventData.startDate = document.getElementById('event-start-date').value;
            eventData.endDate = document.getElementById('event-end-date').value;
            if (!eventData.employeeId || !eventData.startDate || !eventData.endDate) return showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—É—Å–∫–∞', 'error');
            if (eventData.startDate > eventData.endDate) return showNotification('–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è', 'error');
        } else {
            eventData.date = document.getElementById('event-date').value;
            eventData.teamId = document.getElementById('event-team').value;
            eventData.address = document.getElementById('event-address').value.trim();
            if (!eventData.date || !eventData.teamId) return showNotification('–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –∏ –±—Ä–∏–≥–∞–¥—É', 'error');
        }

        await saveEntity('events', eventData);
        closeModal('event-modal');
    }

    // ==================================================================
    // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
    // ==================================================================
    function showNotification(message, type = 'success') { const el = document.createElement('div'); el.className = 'notification'; el.textContent = message; if (type === 'error') el.style.background = '#ff3b30'; document.body.appendChild(el); setTimeout(() => el.remove(), 3000); }
    function formatDate(d) { d = new Date(d); return [d.getFullYear(), `${d.getMonth()+1}`.padStart(2,'0'), `${d.getDate()}`.padStart(2,'0')].join('-'); }
    function getMonthName(d) { return d.toLocaleString('ru-RU', { month: 'long', year: 'numeric' }).replace(' –≥.', ''); }
    function getTeamName(id) { return teams.find(t => t.id === id)?.name || "?"; }
    function getTeamColor(id) { return teams.find(t => t.id === id)?.color || "#ccc"; }
    function getEmployeeName(id) { return employees.find(e => e.id === id)?.name || "?"; }
    function getEventTypeName(type) {
        const types = { 'drilling': '–ë—É—Ä–µ–Ω–∏–µ', 'installation': '–ú–æ–Ω—Ç–∞–∂', 'trip': '–ü–æ–µ–∑–¥–∫–∞', 'vacation': '–û—Ç–ø—É—Å–∫' };
        return types[type] || type;
    }
    
    function createModal(id, content) {
        let modal = document.getElementById(id);
        if (modal) modal.remove();
        modal = document.createElement('div');
        modal.id = id;
        modal.className = 'modal';
        modal.innerHTML = `<div class="modal-content"><h2>${content.title}</h2>${content.body}<div class="button-group-end">${content.footer}</div></div>`;
        document.body.appendChild(modal);
        openModal(id);
    }
    
    function selectModalOption(element, optionClass, hiddenInputSelector, value) {
        element.parentElement.querySelectorAll(`.${optionClass}`).forEach(opt => opt.classList.remove('selected'));
        element.classList.add('selected');
        document.querySelector(hiddenInputSelector).value = value;
        // –î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º—ã —Å–æ–±—ã—Ç–∏–π
        if(typeof window.toggleEventFormFields === 'function' && optionClass === 'event-type-option') {
            toggleEventFormFields(value);
        }
    }

    function openModal(id) { let el = document.getElementById(id); if (el) el.style.display = 'flex'; }
    function closeModal(id) { let el = document.getElementById(id); if (el) el.style.display = 'none'; }
    function prevMonth() { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); }
    function nextMonth() { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); }
    function switchTab(tabId) {
        document.querySelectorAll('.tab-content, .tab').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId)?.classList.add('active');
        document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`)?.classList.add('active');
        document.getElementById('header-title').textContent = document.querySelector(`.tab[onclick="switchTab('${tabId}')"] span:last-child`).textContent;
        document.querySelector('.header').style.display = 'flex';
    }
    function toggleUpcomingEvents() { document.getElementById('upcoming-events').classList.toggle('expanded'); }
    
    // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    document.addEventListener('DOMContentLoaded', () => {
         document.getElementById('password').addEventListener('keypress', e => { if (e.key === 'Enter') login(); });
    });

    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∏–∑ HTML (onclick)
    window.login = login;
    window.logout = logout;
    window.switchTab = switchTab;
    window.prevMonth = prevMonth;
    window.nextMonth = nextMonth;
    window.toggleUpcomingEvents = toggleUpcomingEvents;
    window.openInventoryHistoryModal = openInventoryHistoryModal;
    window.openInventoryOperationModal = openInventoryOperationModal;
    window.selectOperationType = selectOperationType;
    window.saveInventoryOperation = saveInventoryOperation;
    window.closeModal = closeModal;
    window.openTeamModal = openTeamModal;
    window.saveTeam = saveTeam;
    window.openEmployeeModal = openEmployeeModal;
    window.saveEmployee = saveEmployee;
    window.deleteEntity = deleteEntity;
    window.selectModalOption = selectModalOption;
    // --- –ù–û–í–´–ï –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---
    window.openDayDetailsModal = openDayDetailsModal;
    window.openEventModal = openEventModal;
    window.saveEvent = saveEvent;
    window.toggleEventFormFields = toggleEventFormFields;
    </script>
</body>
</html>